<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Master Admin v39 | Pro Management</title>
    <style>
        body { background: #000; color: #0f0; font-family: 'Courier New', monospace; padding: 20px; }
        .card { border: 1px solid #0f0; padding: 15px; margin-bottom: 20px; background: #050505; box-shadow: 0 0 10px rgba(0,255,0,0.2); }
        h2, h4 { margin-top: 0; color: #0f0; text-transform: uppercase; }
        input { background: #000; border: 1px solid #0f0; color: #0f0; padding: 10px; margin: 5px 0; outline: none; }
        button { background: #000; border: 1px solid #0f0; color: #0f0; padding: 10px 15px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        button:hover { background: #0f0; color: #000; }
        .msg-item { border-bottom: 1px solid #1a1a1a; padding: 10px; display: flex; justify-content: space-between; align-items: center; }
        .btn-group { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px; }
        .btn-danger { color: #ff4747; border-color: #ff4747; }
        .btn-danger:hover { background: #ff4747; color: #000; }
        .btn-warning { color: #f1c40f; border-color: #f1c40f; }
        .btn-warning:hover { background: #f1c40f; color: #000; }
        small { color: #888; display: block; margin-top: 4px; }
        #master-list { max-height: 500px; overflow-y: auto; }
    </style>
</head>
<body>

<div id="auth-screen" style="text-align:center; padding-top:100px;">
    <div class="card" style="display:inline-block; width:300px;">
        <h3>GÃœVENLÄ°K DUVARI</h3>
        <input type="password" id="pass" placeholder="YÃ¶netici Åžifresi..." style="width:80%;"> <br>
        <button onclick="login()" style="width:87%; margin-top:10px;">PANELÄ° AÃ‡</button>
    </div>
</div>

<div id="admin-panel" style="display:none;">
    <h2>[ SÄ°STEM YÃ–NETÄ°MÄ° V39 ]</h2>
    
    <div class="card">
        <h4>HIZLI KOMUTLAR (KULLANICI)</h4>
        <input type="text" id="target-id" placeholder="KullanÄ±cÄ± UID..." style="width:100%; max-width:400px;">
        <div class="btn-group">
            <button onclick="doAction('ban')">BANLA</button>
            <button onclick="doAction('unban')">BAN KALDIR</button>
            <button onclick="doAction('rgb_on')">RGB VER</button>
            <button onclick="doAction('rgb_off')">RGB AL</button>
            <button onclick="doAction('limit_off')">SÃœRE SÄ°L (VIP)</button>
            <button onclick="doAction('limit_on')">SÃœRE EKLE (NORMAL)</button>
            <button onclick="doAction('add_admin')" style="color:#f0f; border-color:#f0f;">ADMÄ°N VER</button>
            <button onclick="doAction('remove_admin')" style="color:#f0f; border-color:#f0f;">ADMÄ°N AL</button>
        </div>
    </div>

    <div class="card">
        <h4>ODA YÃ–NETÄ°MÄ° (LOCK/UNLOCK)</h4>
        <input type="text" id="target-chan" placeholder="Oda AdÄ± (Ã–rn: Global veya 24)" style="width:100%; max-width:400px;">
        <div class="btn-group">
            <button class="btn-warning" onclick="lockChan(true)">ðŸ”’ ODAYI KÄ°LÄ°TLE (LOCK)</button>
            <button onclick="lockChan(false)">ðŸ”“ KÄ°LÄ°DÄ° AÃ‡ (UNLOCK)</button>
        </div>
        <small style="margin-top:10px;">* Kilitli odalarda sadece adminler konuÅŸabilir.</small>
    </div>

    <div class="card" style="border-color: #ff4747;">
        <h4>KRÄ°TÄ°K Ä°ÅžLEMLER</h4>
        <button class="btn-danger" onclick="wipeAllData()">TÃœM KANALLARI VE MESAJLARI SIFIRLA (WIPE)</button>
    </div>

    <div class="card">
        <h4>CANLI SOHBET & ID TAKÄ°BÄ°</h4>
        <div id="master-list">Mesajlar taranÄ±yor...</div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue, remove, update, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBEsgu3-BbMIKezTXerExBu6ODmRX-F13U",
      authDomain: "chattheonlibe.firebaseapp.com",
      databaseURL: "https://chattheonlibe-default-rtdb.firebaseio.com",
      projectId: "chattheonlibe",
      storageBucket: "chattheonlibe.firebasestorage.app",
      messagingSenderId: "515915419900",
      appId: "1:515915419900:web:f18286a157558671130779"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);

    signInAnonymously(auth);
    onAuthStateChanged(auth, (user) => {
        if (user) {
            onValue(ref(db, 'system_admins/' + user.uid), (s) => {
                if (s.exists() && s.val().admin === true) openPanel();
            });
        }
    });

    window.login = () => {
        if(document.getElementById('pass').value === 'chatsite23') openPanel();
        else alert("EriÅŸim Reddedildi!");
    };

    function openPanel() {
        document.getElementById('auth-screen').style.display = 'none';
        document.getElementById('admin-panel').style.display = 'block';
        startMonitor();
    }

    // KULLANICI KOMUTLARI
    window.doAction = (act) => {
        const id = document.getElementById('target-id').value.trim();
        if(!id) return alert("Hata: Hedef ID belirtilmedi!");
        
        switch(act) {
            case 'ban': update(ref(db, 'users/'+id), {banned: true}); break;
            case 'unban': update(ref(db, 'users/'+id), {banned: false}); break;
            case 'rgb_on': update(ref(db, 'users/'+id), {isRGB: true}); break;
            case 'rgb_off': update(ref(db, 'users/'+id), {isRGB: false}); break;
            case 'limit_off': update(ref(db, 'users/'+id), {noLimit: true}); break;
            case 'limit_on': update(ref(db, 'users/'+id), {noLimit: false}); break;
            case 'add_admin': set(ref(db, 'system_admins/'+id), {admin: true}); break;
            case 'remove_admin': remove(ref(db, 'system_admins/'+id)); break;
        }
        alert("Ä°ÅŸlem BaÅŸarÄ±lÄ±!");
    };

    // ODA KÄ°LÄ°TLEME FONKSÄ°YONU
    window.lockChan = (status) => {
        const chan = document.getElementById('target-chan').value.trim();
        if(!chan) return alert("Hata: Oda adÄ± girilmedi!");
        
        update(ref(db, `channels/${chan}/settings`), { isLocked: status });
        alert(chan + " odasÄ± " + (status ? "KÄ°LÄ°TLENDÄ° ðŸ”’" : "AÃ‡ILDI ðŸ”“"));
    };

    window.wipeAllData = () => {
        if(confirm("DÄ°KKAT! TÃ¼m veriler silinecek?")) {
            remove(ref(db, 'channels'));
            alert("SÄ±fÄ±rlandÄ±.");
        }
    };

    function startMonitor() {
        onValue(ref(db, 'channels'), (snap) => {
            const list = document.getElementById('master-list');
            list.innerHTML = "";
            const data = snap.val();
            if(!data) return list.innerHTML = "Sohbet temiz.";

            Object.keys(data).forEach(cName => {
                const msgs = data[cName].messages;
                if(msgs) {
                    Object.keys(msgs).forEach(mKey => {
                        const m = msgs[mKey];
                        const item = document.createElement('div');
                        item.className = "msg-item";
                        item.innerHTML = `<div><b>${m.nick}:</b> ${m.text}<small>ID: ${m.uid || '??'} | Oda: ${cName}</small></div>`;
                        const delBtn = document.createElement('button');
                        delBtn.innerText = "SÄ°L";
                        delBtn.onclick = () => remove(ref(db, `channels/${cName}/messages/${mKey}`));
                        item.appendChild(delBtn);
                        list.prepend(item);
                    });
                }
            });
        });
    }
</script>
</body>
</html>

