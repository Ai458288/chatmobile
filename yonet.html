<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Admin Panel v2 | Auto-Channel</title>
    <style>
        body { background: #000; color: #0f0; font-family: monospace; padding: 20px; }
        .box { border: 1px solid #0f0; padding: 15px; margin-bottom: 20px; }
        input, button { background: #000; border: 1px solid #0f0; color: #0f0; padding: 8px; margin: 5px 0; cursor: pointer; }
        #auth-screen { position: fixed; top:0; left:0; width:100%; height:100%; background:#000; display:flex; align-items:center; justify-content:center; flex-direction:column; z-index:100;}
        .msg-item { border-bottom: 1px solid #222; padding: 8px; display: flex; justify-content: space-between; align-items: center; }
        .chan-title { color: #f0f; font-weight: bold; border-bottom: 1px solid #f0f; margin-top: 15px; padding: 5px; }
    </style>
</head>
<body>

<div id="auth-screen">
    <h3>YÃ–NETÄ°M ÅžÄ°FRESÄ°</h3>
    <input type="password" id="pass" placeholder="Åžifre...">
    <button onclick="login()">GÄ°RÄ°Åž</button>
</div>

<div id="admin-content" style="display:none;">
    <h2>[ CHAT SUPREME CONTROL ]</h2>
    
    <div class="box">
        <h4>ðŸ”¨ HIZLI Ä°ÅžLEM</h4>
        <input type="text" id="target-id" placeholder="KullanÄ±cÄ± ID (Ã–rn: 82IR7S...)">
        <br>
        <button onclick="action('ban')">BANLA</button>
        <button onclick="action('rgb_on')">RGB VER</button>
        <button onclick="action('rgb_off')">RGB AL</button>
    </div>

    <div class="box">
        <h4>ðŸ”´ TÃœM KANALLAR VE MESAJLAR</h4>
        <div id="master-list">LÃ¼tfen bekleyin, kanallar yÃ¼kleniyor...</div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue, remove, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBEsgu3-BbMIKezTXerExBu6ODmRX-F13U",
      authDomain: "chattheonlibe.firebaseapp.com",
      databaseURL: "https://chattheonlibe-default-rtdb.firebaseio.com",
      projectId: "chattheonlibe",
      storageBucket: "chattheonlibe.firebasestorage.app",
      messagingSenderId: "515915419900",
      appId: "1:515915419900:web:f18286a157558671130779"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    window.login = () => {
        if(document.getElementById('pass').value === 'chatsite23') {
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('admin-content').style.display = 'block';
            listenAllChannels();
        } else { alert("Åžifre YanlÄ±ÅŸ!"); }
    };

    window.action = (type) => {
        const id = document.getElementById('target-id').value.trim();
        if(!id) return alert("ID girmelisin!");
        
        if(type === 'ban') set(ref(db, 'bans/' + id), { status: true });
        if(type === 'rgb_on') update(ref(db, 'users/' + id), { isRGB: true });
        if(type === 'rgb_off') update(ref(db, 'users/' + id), { isRGB: false });
        alert("Ä°ÅŸlem BaÅŸarÄ±lÄ±!");
    };

    function listenAllChannels() {
        // TÃ¼m kanallarÄ± tek seferde dinle
        onValue(ref(db, 'channels'), (snapshot) => {
            const masterList = document.getElementById('master-list');
            masterList.innerHTML = "";
            
            if(!snapshot.exists()) {
                masterList.innerHTML = "Aktif kanal yok.";
                return;
            }

            snapshot.forEach((chanSnap) => {
                const chanName = chanSnap.key;
                const messages = chanSnap.val().messages;
                
                // Kanal baÅŸlÄ±ÄŸÄ±
                const title = document.createElement('div');
                title.className = "chan-title";
                title.innerText = `# ${chanName}`;
                masterList.appendChild(title);

                if(messages) {
                    Object.keys(messages).forEach(msgKey => {
                        const m = messages[msgKey];
                        const item = document.createElement('div');
                        item.className = "msg-item";
                        item.innerHTML = `
                            <span>[${chanName}] <b>${m.nick}:</b> ${m.text} <br><small>ID: ${m.uid}</small></span>
                            <button onclick="delMsg('${chanName}', '${msgKey}')" style="color:red; border-color:red;">SÄ°L</button>
                        `;
                        masterList.appendChild(item);
                    });
                }
            });
        });
    }

    window.delMsg = (cName, mKey) => {
        if(confirm("Silmek istiyor musun?")) {
            remove(ref(db, `channels/${cName}/messages/${mKey}`));
        }
    };
</script>
</body>
</html>
